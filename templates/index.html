<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fake Loan App Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="nav-left">
        <div class="logo">LoanShield</div>

        {% if session.get('name') %}
            <div class="greeting">Hi, {{ session['name'] }}</div>
        {% endif %}
    </div>

    <ul class="nav-right">
        <li><a href="#" onclick="showSection('home')">Home</a></li>
        <li><a href="#" onclick="showSection('scan')">Scan</a></li>
        <li><a href="#" onclick="showSection('report')">Report</a></li>
        <li><a href="#" onclick="showSection('guidelines')">Guidelines</a></li>

        {% if session.get('name') %}
            <li><a href="/logout" class="logout-btn">Logout</a></li>
        {% else %}
            <li><a href="/login">Login</a></li>
            <li><a href="/register" class="nav-btn">Register</a></li>
        {% endif %}
    </ul>
</nav>

<!-- HOME -->
<section id="home" class="page-section active hero">
    <div class="home-container">
        <div class="home-text">
            <h1>Detect Fake Loan Apps<br>Before They Trap You</h1>
            <p>Scan apps, report scams, and stay financially safe.</p>
            <div class="home-buttons">
                <button class="cta" onclick="showSection('scan')">Scan App</button>
                <button class="secondary-btn" onclick="showSection('guidelines')">Guidelines</button>
            </div>
        </div>
        <div class="home-image">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135706.png">
        </div>
    </div>
</section>

<!-- SCAN -->
<section id="scan" class="page-section">
    <h2>Scan Loan Application</h2>

    <form action="/predict" method="POST">
        <input
            type="text"
            name="app_name"
            placeholder="Enter App Name or Play Store App ID"
            {% if not session.get('name') %}disabled{% endif %}
            required
        >

        {% if session.get('name') %}
            <button type="submit">Check App</button>
        {% else %}
            <button type="button" class="disabled-btn" onclick="window.location.href='/login'">
                Login to Scan
            </button>
        {% endif %}
    </form>
</section>

<!-- REPORT -->
<section id="report" class="page-section">
    <div class="report-container">
        <h2>Report Fake Loan App</h2>

        <!-- ✅ AJAX FIX -->
        <form id="reportForm">
            <input
                type="text"
                name="app_name"
                placeholder="Enter app name"
                {% if not session.get('name') %}disabled{% endif %}
                required
            >

            <textarea
                name="reason"
                placeholder="Why is this app fake?"
                {% if not session.get('name') %}disabled{% endif %}
                required
            ></textarea>

            {% if session.get('name') %}
                <button type="submit">Submit Report</button>
            {% else %}
                <button type="button" class="disabled-btn" onclick="window.location.href='/login'">
                    Login to Report
                </button>
            {% endif %}
        </form>
    </div>
</section>

<!-- GUIDELINES -->
<section id="guidelines" class="page-section">
    <h2>Safety Guidelines</h2>
    <ul class="guidelines">
        <li>✔ Download loan apps only from Google Play Store</li>
        <li>✔ Verify NBFC or RBI registration</li>
        <li>✔ Avoid apps shared via WhatsApp or SMS</li>
        <li>✔ Check developer and company details</li>
        <li>✔ Read recent user reviews carefully</li>
        <li>✔ Beware of apps asking for contacts or SMS access</li>
        <li>✔ Avoid advance payment or hidden charges</li>
        <li>✔ Genuine apps never threaten or harass users</li>
        <li>✔ Instant loan approval without checks is risky</li>
        <li>✔ Report suspicious apps immediately</li>
    </ul>
</section>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<!-- ✅ REPORT FIX SCRIPT -->
<script>
document.getElementById("reportForm")?.addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    fetch("/report", {
        method: "POST",
        body: formData
    })
    .then(res => res.text())
    .then(msg => {
        alert(msg);
        this.reset();
    })
    .catch(() => alert("Error submitting report"));
});
</script>

</body>
</html>
